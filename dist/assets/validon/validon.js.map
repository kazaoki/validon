{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","replace","RegExp","location","origin","validon","Validon","opt","eachfire","form","errortag","config","loadedFunc","errorgroup","startFunc","errorposition","beforeFunc","afterFunc","finishFunc","urlPath","onload","querySelector","console","warn","style","pointerEvents","event","preventDefault","returnValue","send","addEventListener","attachEvent","submitEvent","elems","querySelectorAll","length","eventName","getAttribute","i","eventNames","type","tagName","j","e","this","name","srcElement","window","windowOnload","msg","url","line","col","error","hasOwnProperty","objectMerge","a","b","key","member","Object","prototype","toString","call","Math","max","min","callback","json","params","hasFileApi","File","elements","matches","match","_typeof","Array","paramSet","value","lump","selected","files","size","isSubmit","keys","targets","push","xhr","XMLHttpRequest","onreadystatechange","status","readyState","response","JSON","parse","responseText","changes","elem","options","indexOf","checked","list","errors","raw_name","errorholder","parent","parentNode","toUpperCase","createElement","setAttribute","appendChild","insertBefore","childNodes","message","innerHTML","submit","open","setRequestHeader","responseType","setkey","merged","data","$f","retvar","o","TypeError","p","k","fromIndex","that","Len"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form          = opt.form\n\tvalidon.config        = opt.config\n\tvalidon.eachfire      = opt.eachfire || false\n\tvalidon.errorgroup    = opt.errorgroup || 'section'\n\tvalidon.errorposition = opt.errorposition || 'append'\n\tvalidon.errortag      = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.loadedFunc    = opt.loadedFunc  // コンストラクタ生成後に実行する関数\n\tvalidon.startFunc     = opt.startFunc   // 開始してすぐ実行する関数\n\tvalidon.beforeFunc    = opt.beforeFunc  // json送信直前に実行する関数\n\tvalidon.afterFunc     = opt.afterFunc   // json受信直後に実行する関数\n\tvalidon.finishFunc    = opt.finishFunc  // 処理完了後に実行する関数\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// 対象フォームがクリック不可になっていたら困るので戻し\n\t\tvalidon.form.style.pointerEvents = ''\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火が有効の場合、各要素に `onChange` が登録され都度バリデートされるようになる。\n\t\t// ※要素ごとに設定も可能（例： data-validon-on='change,keydown' ← カンマで複数指定可\n\t\tif(validon.eachfire || validon.form.querySelectorAll('[data-validon-on]').length) {\n\t\t\tvar elems = validon.eachfire\n\t\t\t\t? validon.form.querySelectorAll('[name]')\n\t\t\t\t: validon.form.querySelectorAll('[data-validon-on]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tvar eventName = elems[i].getAttribute('data-validon-on')\n\t\t\t\tif(!eventName) {\n\t\t\t\t\tif(\n\t\t\t\t\t\telems[i].type==='radio' ||\n\t\t\t\t\t\telems[i].type==='checkbox' ||\n\t\t\t\t\t\telems[i].type==='file' ||\n\t\t\t\t\t\telems[i].tagName==='SELECT'\n\t\t\t\t\t) {\n\t\t\t\t\t\teventName = 'change'\n\t\t\t\t\t} else {\n\t\t\t\t\t\teventName = 'blur'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar eventNames = eventName.split(/\\s*\\,\\s*/)\n\t\t\t\tfor(var j=0; j<eventNames.length; j++) {\n\t\t\t\t\tvar event = eventNames[j];\n\t\t\t\t\tif (elems[i].addEventListener) {\n\t\t\t\t\t\telems[i].addEventListener(event, function(e){ validon.send(this.name) }, false)\n\t\t\t\t\t} else if (elems[i].attachEvent) {\n\t\t\t\t\t\telems[i].attachEvent('on'+event, function(e){ validon.send(e.srcElement.name) })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// フック：loadedFunc\n\t\tif(validon.loadedFunc && 'function' === typeof validon.loadedFunc) {\n\t\t\tif(false === validon.loadedFunc()) return false\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n\n\t// エラーが起きたら対象フォームのクリック解除\n\twindow.onerror = function(msg, url, line, col, error) {\n\t\tif(validon.form.hasOwnProperty('style')) {\n\t\t\tvalidon.form.style.pointerEvents = ''\n\t\t}\n\t}\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(elems, callback){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// フック：startFunc\n\t\tif(validon.startFunc && 'function' === typeof validon.startFunc) {\n\t\t\tif(false === validon.startFunc(json)) return false\n\t\t}\n\n\t\t// submit中は要素を全てクリックできないように\n\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = 'none'\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elements = validon.form.querySelectorAll('[name]')\n\t\tvar hasFileApi = !!window.File;\n\t\tfor(var i=0; i<elements.length; i++) {\n\n\t\t\tvar name = elements[i].getAttribute('name')\n\n\t\t\t// 各要素にとりあえず空をセットする（未選択要素でもajaxで飛ばしたいので）\n\t\t\tvar matches;\n\t\t\tif(matches = name.match(/^(.+?)\\[(.*)\\]$/)) {\n\t\t\t\tif(matches[2].length){\n\t\t\t\t\t// name=\"color[abc]\"\n\t\t\t\t\tif('object'!==typeof params[matches[1]]) params[matches[1]] = new Object()\n\t\t\t\t} else {\n\t\t\t\t\t// name=\"color[]\"\n\t\t\t\t\tif('object'!==typeof params[matches[1]]) params[matches[1]] = new Array()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// name=\"color\"\n\t\t\t\tif('undefined'===typeof params[name]) params[name] = ''\n\t\t\t}\n\n\t\t\t// ラジオボタン or チェックボックス\n\t\t\tif(\n\t\t\t\t'radio'   ===elements[i].type ||\n\t\t\t\t'checkbox'===elements[i].type\n\t\t\t) {\n\t\t\t\tif(elements[i].checked) {\n\t\t\t\t\tthis.paramSet(params, name, elements[i].value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// セレクトプルダウン\n\t\t\telse if('SELECT'===elements[i].tagName) {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tfor(var j=0; j<lump.length; j++) {\n\t\t\t\t\tif(lump[j].selected) this.paramSet(params, name, lump[j].value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// ファイル選択（FileAPIが使用できる場合は name,type,size をセットする）\n\t\t\telse if(elements[i].type==='file' && hasFileApi) {\n\t\t\t\tif(elements[i].files.length) {\n\t\t\t\t\tvar files = new Array();\n\t\t\t\t\tfor(var j=0; j<elements[i].files.length; j++){\n\t\t\t\t\t\tfiles.push({\n\t\t\t\t\t\t\tname: elements[i].files[j]['name'],\n\t\t\t\t\t\t\ttype: elements[i].files[j]['type'],\n\t\t\t\t\t\t\tsize: elements[i].files[j]['size'],\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tif(1===files.length) files=files[0] // 1つなら上へ上げる\n\t\t\t\t\tthis.paramSet(params, name, files)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// その他の要素\n\t\t\telse {\n\t\t\t\tthis.paramSet(params, name, elements[i].value)\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof elems === 'undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof elems ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(elems)\n\t\t} else if(elems instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tjson.targets.push(elems[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc && 'function' === typeof validon.beforeFunc) {\n\t\t\tif(false === validon.beforeFunc(json)) {\n\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4 === this.readyState) {\n\t\t\t\tif(200 === this.status) {\n\t\t\t\t\tjson = this.response\n\t\t\t\t\tif('undefined' === typeof json || 'string' === typeof json) {\n\t\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：afterFunc\n\t\t\t\t\tif(validon.afterFunc && 'function' === typeof validon.afterFunc) {\n\t\t\t\t\t\tif(false === validon.afterFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみ値の変更があれば反映する\n\t\t\t\t\tif(json.changes && json.changes.length) {\n\t\t\t\t\t\tfor(var i=0; i<json.changes.length; i++) {\n\t\t\t\t\t\t\tvar name = json.changes[i]\n\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(!elem) continue\n\t\t\t\t\t\t\tif(\n\t\t\t\t\t\t\t\t'INPUT' === elem.tagName &&\n\t\t\t\t\t\t\t\t('radio' === elem.getAttribute('type') || 'checkbox' === elem.getAttribute('type'))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tvar elems = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\t\tfor(var j=0; j<elems.length; j++) {\n\t\t\t\t\t\t\t\t\telems[j].checked = -1 !== json.params[name].indexOf(elems[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if('SELECT' === elem.tagName) {\n\t\t\t\t\t\t\t\tvar options = elem.querySelectorAll('option')\n\t\t\t\t\t\t\t\tfor(var j=0; j<options.length; j++) {\n\t\t\t\t\t\t\t\t\toptions[j].selected = -1 !== json.params[name].indexOf(options[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telem.value = json.params[name]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみエラーがあれば反映する\n\t\t\t\t\tif(json.targets && json.targets.length) {\n\t\t\t\t\t\t// エラーにxxx[]が入ってくるようであれば、キーがxxxだけでも表示対象にするように。\n\t\t\t\t\t\tvar list = json.targets;\n\t\t\t\t\t\tfor(var i in list) {\n\t\t\t\t\t\t\tfor(var key in json.errors) {\n\t\t\t\t\t\t\t\tif(key.match(new RegExp('^'+list[i]+'\\\\\\['))) list.push(key)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 開始\n\t\t\t\t\t\tfor(var i=0; i<list.length; i++) {\n\t\t\t\t\t\t\tvar name = list[i]\n\t\t\t\t\t\t\tvar raw_name = name.replace(/\\[.*?\\]/, '')\n\t\t\t\t\t\t\tvar errorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(!errorholder.length){\n\t\t\t\t\t\t\t\t// [] はずしたもので探す\n\t\t\t\t\t\t\t\tname = raw_name\n\t\t\t\t\t\t\t\terrorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\n\t\t\t\t\t\t\t\t// 無ければ [] つけたもので探す\n\t\t\t\t\t\t\t\tif(!errorholder.length){\n\t\t\t\t\t\t\t\t\tname = raw_name+'[]'\n\t\t\t\t\t\t\t\t\terrorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// エラーホルダーが指定されてなければ自動で用意\n\t\t\t\t\t\t\tif(!errorholder.length) {\n\n\t\t\t\t\t\t\t\t// 対象要素探す\n\t\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\t\tif(!elem) {\n\t\t\t\t\t\t\t\t\t// なければ[]付きのを要素を探す\n\t\t\t\t\t\t\t\t\telem = validon.form.querySelector('[name^=\"'+name+'[\"]')\n\t\t\t\t\t\t\t\t\tif(!elem) {\n\t\t\t\t\t\t\t\t\t\t// console.warn('Missing element: \"'+name+'\"');\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// 対象要素の位置からエラーホルダーを生成する\n\t\t\t\t\t\t\t\tvar parent = elem.parentNode\n\t\t\t\t\t\t\t\twhile (parent.tagName !== validon.errorgroup.toUpperCase()) {\n\t\t\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t\t\t\tif('undefined' === typeof parent.tagName) {\n\t\t\t\t\t\t\t\t\t\tparent = elem.parentNode\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = document.createElement('div')\n\t\t\t\t\t\t\t\terrorholder.setAttribute('data-validon-errorholder', name)\n\t\t\t\t\t\t\t\tif(validon.errorposition === 'append') {\n\t\t\t\t\t\t\t\t\tparent.appendChild(errorholder)\n\t\t\t\t\t\t\t\t} else if(validon.errorposition === 'prepend') {\n\t\t\t\t\t\t\t\t\tparent.insertBefore(errorholder, parent.childNodes[0]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = new Array(errorholder)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar message = ''\n\t\t\t\t\t\t\tif(json.errors && 'undefined' !== typeof json.errors[raw_name]) {\n\t\t\t\t\t\t\t\tmessage = validon.errortag.replace(/\\$message/, json.errors[raw_name])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor(var j=0; j<errorholder.length; j++) {\n\t\t\t\t\t\t\t\terrorholder[j].innerHTML = message\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 第二引数に関数が指定されていたらここで実行\n\t\t\t\t\tif(callback && 'function' === typeof callback) {\n\t\t\t\t\t\tcallback(json)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：finsihFunc\n\t\t\t\t\tif(validon.finishFunc && 'function' === typeof validon.finishFunc) {\n\t\t\t\t\t\tif(false === validon.finishFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// エラーが一つも無ければsubmitする（isSubmit時のみ）\n\t\t\t\t\tif(!Object.keys(json.errors).length && json.isSubmit) validon.form.submit()\n\t\t\t\t\telse {\n\t\t\t\t\t\t// エラーがある場合はsubmit中のクリック不可を戻す\n\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t},\n\n\t/**\n\t * params変数をセットするメソッド。キー名に[.*]がある場合は1次元まで配列にする。\n\t *\n\t * ex. color=red           -> params['color']   = 'red'\n\t * ex. color[]=red         -> params['color[]'] = ['red']\n\t * ex. color[123]=red      -> params['color[]'] = [{'123': 'red'}]\n\t * ex. color[123][456]=red -> params['color[]'] = [{'123[456]': 'red'}]\n\t */\n\tparamSet: function(params, name, value)\n\t{\n\t\t// 配列・オブジェクトに展開する再帰関数\n\t\tvar $f = function(key, value)\n\t\t{\n\t\t\tvar matches;\n\t\t\tif(matches = key.match(/^.*?\\[(.*?)\\](.*)$/)) {\n\t\t\t\tif(matches[1].length) {\n\t\t\t\t\tvar retvar = new Object()\n\t\t\t\t\tretvar[matches[1]] = matches[2]\n\t\t\t\t\t\t? $f(matches[2], value)\n\t\t\t\t\t\t: value\n\t\t\t\t\t;\n\t\t\t\t\treturn retvar\n\t\t\t\t} else {\n\t\t\t\t\tvar retvar = new Array()\n\t\t\t\t\tretvar.push(matches[2]\n\t\t\t\t\t\t? $f(matches[2], value)\n\t\t\t\t\t\t: value\n\t\t\t\t\t)\n\t\t\t\t\treturn retvar\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value\n\t\t\t}\n\t\t}\n\n\t\t// セットするキー名生成\n\t\tvar setkey = name.replace(/\\[.*$/, '')\n\n\t\t// 既存のオブジェクトとマージ\n\t\tvar merged = objectMerge(\n\t\t\t{data: $f(name, value)},\n\t\t\t{data: params[setkey]}\n\t\t)\n\t\tparams[setkey] = merged['data']\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n\n/**\n * Array.indexOf Polyfill\n * https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Polyfill\n */\nif (!Array.prototype.indexOf) Array.prototype.indexOf = (function (Object, max, min) {\n\t\"use strict\";\n\treturn function indexOf(member, fromIndex) {\n\t\tif (this === null || this === undefined) throw TypeError(\"Array.prototype.indexOf called on null or undefined\");\n\t\tvar that = Object(this), Len = that.length >>> 0, i = min(fromIndex | 0, Len);\n\t\tif (i < 0) i = max(0, Len + i); else if (i >= Len) return -1;\n\t\tif (member === void 0) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] === void 0 && i in that) return i; // undefined\n\t\t} else if (member !== member) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] !== that[i]) return i; // NaN\n\t\t} else for (; i !== Len; ++i) if (that[i] === member) return i; // all else\n\t\treturn -1; // if the value was not found, then return -1\n\t};\n})(Object, Math.max, Math.min);\n\n/**\n * オブジェクトマージ関数\n * ※配列はconcat()される\n */\nfunction objectMerge(a, b) {\n\tfor (var key in b) {\n\t\tif (b.hasOwnProperty(key)) {\n\t\t\ta[key] = (key in a)\n\t\t\t\t? (\n\t\t\t\t\t(\n\t\t\t\t\t\tObject.prototype.toString.call(a[key]) === '[object Object]' &&\n\t\t\t\t\t\tObject.prototype.toString.call(b[key]) === '[object Object]'\n\t\t\t\t\t)\n\t\t\t\t\t\t? objectMerge(a[key], b[key])\n\t\t\t\t\t\t: (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tObject.prototype.toString.call(a[key]) === '[object Array]' &&\n\t\t\t\t\t\t\t\tObject.prototype.toString.call(b[key]) === '[object Array]'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t? b[key].concat(a[key])\n\t\t\t\t\t\t\t\t: a[key]\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t: b[key];\n\t\t}\n\t}\n\treturn a;\n};\n"]}