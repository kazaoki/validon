{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","length","replace","RegExp","location","origin","Validon","validon","eachfire","opt","position","form","config","urlPath","errortag","windowOnload","window","afterFunc","onload","querySelector","console","warn","event","preventDefault","send","attachEvent","returnValue","elems","addEventListener","submitEvent","querySelectorAll","i","getAttribute","type","tagName","setAttribute","elem","e","srcElement","eventName","this","name","prototype","args","json","params","lump","checked","value","push","selected","isSubmit","targets","Object","keys","Array","beforeFunc","xhr","onreadystatechange","readyState","status","JSON","response","parse","responseText","responseType","stringify","p","o","k","hasOwnProperty","call"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form       = opt.form\n\tvalidon.config     = opt.config\n\tvalidon.eachfire   = opt.eachfire || false\n\tvalidon.errortag   = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.position   = opt.position || 'append'\n\tvalidon.beforeFunc = opt.beforeFunc\n\tvalidon.afterFunc  = opt.afterFunc\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火の標準設定（ラジオ、チェックボックス、プルダウンはonChange、それ以外はonBlurとす）\n\t\t// 個別に指定したい場合は data-validon-on が優先になる。\n\t\tif(validon.eachfire) {\n\t\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tif(elems[i].getAttribute('data-validon-on')) continue\n\t\t\t\tif(elems[i].type==='radio' || elems[i].type==='checkbox' || elems[i].tagName==='SELECT') {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'change')\n\t\t\t\t} else {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'blur')\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 個別イベント登録\n\t\tvar elems = validon.form.querySelectorAll('[data-validon-on]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar elem = elems[i]\n\t\t\tvar eventName = elem.getAttribute('data-validon-on')\n\t\t\tif (elem.addEventListener) {\n\t\t\t\telem.addEventListener(eventName, function(e){ validon.send(this.name) }, false)\n\t\t\t} else if (elem.attachEvent) {\n\t\t\t\telem.attachEvent('on'+eventName, function(e){ validon.send(e.srcElement.name) })\n\t\t\t}\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(args){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar name = elems[i].getAttribute('name')\n\t\t\tif('undefined'!==typeof params[name]) continue\n\t\t\tif(elems[i].type==='radio') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name] = lump[i].value\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].type==='checkbox') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].tagName==='SELECT') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].selected) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams[name] = elems[i].value\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof args ==='undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof args ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(args)\n\t\t} else if(args instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<args.length; i++) {\n\t\t\t\tjson.targets.push(args[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc) {\n\t\t\tif(false===validon.beforeFunc(json)) return false\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4===this.readyState && 200===this.status) {\n\t\t\t\tjson = this.response\n\t\t\t\tif(typeof this.response ==='undefined') {\n\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t}\n\n\t\t\t\t// フック：afterFunc\n\t\t\t\tif(false===validon.afterFunc(json)) return false\n\n\t\t\t\t// ターゲットのみエラーを反映する\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n"]}