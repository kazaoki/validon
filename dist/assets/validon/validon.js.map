{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","replace","RegExp","location","origin","validon","form","opt","eachfire","errortag","startFunc","beforeFunc","afterFunc","finishFunc","urlPath","console","window","onload","config","querySelector","warn","style","pointerEvents","addEventListener","event","preventDefault","attachEvent","returnValue","submitEvent","querySelectorAll","elems","i","eventName","length","getAttribute","eventNames","name","send","split","j","e","this","windowOnload","srcElement","Validon","prototype","callback","json","hasFileApi","elements","params","File","matches","match","key","_typeof","Object","Array","type","checked","paramSet","value","files","tagName","lump","push","size","targets","isSubmit","keys","XMLHttpRequest","onreadystatechange","status","xhr","readyState","response","JSON","parse","responseText","changes","elem","options","selected","errorholder","indexOf","parent","createElement","setAttribute","errorposition","appendChild","insertBefore","errorgroup","toUpperCase","parentNode","message","childNodes","errors","innerHTML","setRequestHeader","submit","open","stringify","k","o","TypeError","p","that","hasOwnProperty","call","Len","max","min","member","fromIndex","Math"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form          = opt.form\n\tvalidon.config        = opt.config\n\tvalidon.eachfire      = opt.eachfire || false\n\tvalidon.errorgroup    = opt.errorgroup || 'section'\n\tvalidon.errorposition = opt.errorposition || 'append'\n\tvalidon.errortag      = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.startFunc     = opt.startFunc  // 開始してすぐ実行する関数\n\tvalidon.beforeFunc    = opt.beforeFunc // json送信直前に実行する関数\n\tvalidon.afterFunc     = opt.afterFunc  // json受信直後に実行する関数\n\tvalidon.finishFunc    = opt.finishFunc // 処理完了後に実行する関数\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// 対象フォームがクリック不可になっていたら困るので戻し\n\t\tvalidon.form.style.pointerEvents = ''\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火が有効の場合、各要素に `onChange` が登録され都度バリデートされるようになる。\n\t\t// ※要素ごとに設定も可能（例： data-validon-on='change,keydown' ← カンマで複数指定可\n\t\tif(validon.eachfire || validon.form.querySelectorAll('[data-validon-on]').length) {\n\t\t\tvar elems = validon.eachfire\n\t\t\t\t? validon.form.querySelectorAll('[name]')\n\t\t\t\t: validon.form.querySelectorAll('[data-validon-on]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tvar eventName = elems[i].getAttribute('data-validon-on')\n\t\t\t\tif(!eventName) {\n\t\t\t\t\tif(\n\t\t\t\t\t\telems[i].type==='radio' ||\n\t\t\t\t\t\telems[i].type==='checkbox' ||\n\t\t\t\t\t\telems[i].type==='file' ||\n\t\t\t\t\t\telems[i].tagName==='SELECT'\n\t\t\t\t\t) {\n\t\t\t\t\t\teventName = 'change'\n\t\t\t\t\t} else {\n\t\t\t\t\t\teventName = 'blur'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar eventNames = eventName.split(/\\s*\\,\\s*/)\n\t\t\t\tfor(var j=0; j<eventNames.length; j++) {\n\t\t\t\t\tvar event = eventNames[j];\n\t\t\t\t\tif (elems[i].addEventListener) {\n\t\t\t\t\t\telems[i].addEventListener(event, function(e){ validon.send(this.name) }, false)\n\t\t\t\t\t} else if (elems[i].attachEvent) {\n\t\t\t\t\t\telems[i].attachEvent('on'+event, function(e){ validon.send(e.srcElement.name) })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(elems, callback){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// フック：startFunc\n\t\tif(validon.startFunc && 'function' === typeof validon.startFunc) {\n\t\t\tif(false === validon.startFunc(json)) return false\n\t\t}\n\n\t\t// submit中は要素を全てクリックできないように\n\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = 'none'\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elements = validon.form.querySelectorAll('[name]')\n\t\tvar hasFileApi = !!window.File;\n\t\tfor(var i=0; i<elements.length; i++) {\n\n\t\t\tvar name = elements[i].getAttribute('name')\n\n\t\t\t// 各要素にとりあえず空をセットする（未選択要素でもajaxで飛ばしたいので）\n\t\t\tvar matches;\n\t\t\tif(matches = name.match(/^(.+?)\\[(.*)\\]$/)) {\n\t\t\t\tvar key = matches[1]+'[]'\n\t\t\t\tif(matches[2].length){\n\t\t\t\t\t// name=\"color[abc]\"\n\t\t\t\t\tif('object'!==typeof params[key]) params[key] = new Object()\n\t\t\t\t} else {\n\t\t\t\t\t// name=\"color[]\"\n\t\t\t\t\tif('object'!==typeof params[key]) params[key] = new Array()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// name=\"color\"\n\t\t\t\tparams[name] = ''\n\t\t\t}\n\n\t\t\t// ラジオボタン or チェックボックス\n\t\t\tif(\n\t\t\t\t'radio'   ===elements[i].type ||\n\t\t\t\t'checkbox'===elements[i].type\n\t\t\t) {\n\t\t\t\tif(elements[i].checked) this.paramSet(params, name, elements[i].value)\n\t\t\t}\n\t\t\t// セレクトプルダウン\n\t\t\telse if('SELECT'===elements[i].tagName) {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tfor(var j=0; j<lump.length; j++) {\n\t\t\t\t\tif(lump[j].selected) this.paramSet(params, name, lump[j].value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// ファイル選択（FileAPIが使用できる場合は name,type,size をセットする）\n\t\t\telse if(elements[i].type==='file' && hasFileApi) {\n\t\t\t\tif(elements[i].files.length) {\n\t\t\t\t\tvar files = new Array();\n\t\t\t\t\tfor(var j=0; j<elements[i].files.length; j++){\n\t\t\t\t\t\tfiles.push({\n\t\t\t\t\t\t\tname: elements[i].files[j]['name'],\n\t\t\t\t\t\t\ttype: elements[i].files[j]['type'],\n\t\t\t\t\t\t\tsize: elements[i].files[j]['size'],\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tif(1===files.length) files=files[0] // 1つなら上へ上げる\n\t\t\t\t\tthis.paramSet(params, name, files)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// その他の要素\n\t\t\telse {\n\t\t\t\tthis.paramSet(params, name, elements[i].value)\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof elems === 'undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof elems ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(elems)\n\t\t} else if(elems instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tjson.targets.push(elems[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc && 'function' === typeof validon.beforeFunc) {\n\t\t\tif(false === validon.beforeFunc(json)) {\n\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4 === this.readyState) {\n\t\t\t\tif(200 === this.status) {\n\t\t\t\t\tjson = this.response\n\t\t\t\t\tif('undefined' === typeof json || 'string' === typeof json) {\n\t\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：afterFunc\n\t\t\t\t\tif(validon.afterFunc && 'function' === typeof validon.afterFunc) {\n\t\t\t\t\t\tif(false === validon.afterFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみ値の変更があれば反映する\n\t\t\t\t\tif(json.changes && json.changes.length) {\n\t\t\t\t\t\t\tfor(var i=0; i<json.changes.length; i++) {\n\t\t\t\t\t\t\tvar name = json.changes[i]\n\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(\n\t\t\t\t\t\t\t\t'INPUT' === elem.tagName &&\n\t\t\t\t\t\t\t\t('radio' === elem.getAttribute('type') || 'checkbox' === elem.getAttribute('type'))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tvar elems = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\t\tfor(var j=0; j<elems.length; j++) {\n\t\t\t\t\t\t\t\t\telems[j].checked = -1 !== json.params[name].indexOf(elems[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if('SELECT' === elem.tagName) {\n\t\t\t\t\t\t\t\tvar options = elem.querySelectorAll('option')\n\t\t\t\t\t\t\t\tfor(var j=0; j<options.length; j++) {\n\t\t\t\t\t\t\t\t\toptions[j].selected = -1 !== json.params[name].indexOf(options[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telem.value = json.params[name]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみエラーがあれば反映する\n\t\t\t\t\tif(json.targets && json.targets.length) {\n\t\t\t\t\t\tfor(var i=0; i<json.targets.length; i++) {\n\t\t\t\t\t\t\tvar name = json.targets[i]\n\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\tvar errorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(!errorholder.length) {\n\t\t\t\t\t\t\t\tvar parent = elem.parentNode\n\t\t\t\t\t\t\t\twhile (parent.tagName !== validon.errorgroup.toUpperCase()) {\n\t\t\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t\t\t\tif('undefined' === typeof parent.tagName) {\n\t\t\t\t\t\t\t\t\t\tparent = elem.parentNode\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = document.createElement('div')\n\t\t\t\t\t\t\t\terrorholder.setAttribute('data-validon-errorholder', name)\n\t\t\t\t\t\t\t\tif(validon.errorposition === 'append') {\n\t\t\t\t\t\t\t\t\tparent.appendChild(errorholder)\n\t\t\t\t\t\t\t\t} else if(validon.errorposition === 'prepend') {\n\t\t\t\t\t\t\t\t\tparent.insertBefore(errorholder, parent.childNodes[0]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = new Array(errorholder)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar message = ''\n\t\t\t\t\t\t\tif(json.errors && 'undefined' !== typeof json.errors[name]) {\n\t\t\t\t\t\t\t\tmessage = validon.errortag.replace(/\\$message/, json.errors[name])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor(var j=0; j<errorholder.length; j++) {\n\t\t\t\t\t\t\t\terrorholder[j].innerHTML = message\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 第二引数に関数が指定されていたらここで実行\n\t\t\t\t\tif(callback && 'function' === typeof callback) {\n\t\t\t\t\t\tcallback(json)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：finsihFunc\n\t\t\t\t\tif(validon.finishFunc && 'function' === typeof validon.finishFunc) {\n\t\t\t\t\t\tif(false === validon.finishFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// エラーが一つも無ければsubmitする（isSubmit時のみ）\n\t\t\t\t\tif(!json.errors && json.isSubmit) validon.form.submit()\n\t\t\t\t\telse {\n\t\t\t\t\t\t// エラーがある場合はsubmit中のクリック不可を戻す\n\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t},\n\n\t/**\n\t * params変数をセットするメソッド。キー名に[.*]がある場合は1次元まで配列にする。\n\t *\n\t * ex. color=red           -> params['color']   = 'red'\n\t * ex. color[]=red         -> params['color[]'] = ['red']\n\t * ex. color[123]=red      -> params['color[]'] = [{'123': 'red'}]\n\t * ex. color[123][456]=red -> params['color[]'] = [{'123[456]': 'red'}]\n\t */\n\tparamSet: function(params, name, value) {\n\t\tvar matches;\n\t\tif(matches = name.match(/^(.+?)\\[(.*)\\]$/)) {\n\t\t\tvar key = matches[1]+'[]'\n\t\t\tif(matches[2].length){\n\t\t\t\tif('object'!==typeof params[key]) params[key] = new Object()\n\t\t\t\tparams[key][matches[2]] = value\n\t\t\t} else {\n\t\t\t\tif('object'!==typeof params[key]) params[key] = new Array()\n\t\t\t\tparams[key].push(value)\n\t\t\t}\n\t\t} else {\n\t\t\tparams[name] = value\n\t\t}\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n\n/**\n * Array.indexOf Polyfill\n * https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Polyfill\n */\nif (!Array.prototype.indexOf) Array.prototype.indexOf = (function (Object, max, min) {\n\t\"use strict\";\n\treturn function indexOf(member, fromIndex) {\n\t\tif (this === null || this === undefined) throw TypeError(\"Array.prototype.indexOf called on null or undefined\");\n\n\t\tvar that = Object(this), Len = that.length >>> 0, i = min(fromIndex | 0, Len);\n\t\tif (i < 0) i = max(0, Len + i); else if (i >= Len) return -1;\n\n\t\tif (member === void 0) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] === void 0 && i in that) return i; // undefined\n\t\t} else if (member !== member) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] !== that[i]) return i; // NaN\n\t\t} else for (; i !== Len; ++i) if (that[i] === member) return i; // all else\n\n\t\treturn -1; // if the value was not found, then return -1\n\t};\n})(Object, Math.max, Math.min);\n"]}