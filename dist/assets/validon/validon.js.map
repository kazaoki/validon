{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","replace","RegExp","location","origin","validon","form","opt","eachfire","errortag","beforeFunc","afterFunc","errorgroup","errorposition","urlPath","console","window","onload","config","querySelector","warn","event","submitEvent","preventDefault","addEventListener","attachEvent","returnValue","elems","querySelectorAll","i","setAttribute","getAttribute","type","tagName","elem","eventName","send","name","srcElement","e","this","windowOnload","Validon","prototype","callback","json","params","elements","lump","length","checked","value","selected","targets","isSubmit","Object","keys","push","Array","xhr","XMLHttpRequest","readyState","status","response","JSON","parse","responseText","errorholder","parent","parentNode","toUpperCase","createElement","appendChild","insertBefore","childNodes","message","errors","j","innerHTML","_typeof","open","setRequestHeader","responseType","stringify","o","TypeError","k","p","hasOwnProperty"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form          = opt.form\n\tvalidon.config        = opt.config\n\tvalidon.eachfire      = opt.eachfire || false\n\tvalidon.errorgroup    = opt.errorgroup || 'section'\n\tvalidon.errorposition = opt.errorposition || 'append'\n\tvalidon.errortag      = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.beforeFunc    = opt.beforeFunc\n\tvalidon.afterFunc     = opt.afterFunc\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火の標準設定（ラジオ、チェックボックス、プルダウンはonChange、それ以外はonBlurとす）\n\t\t// 個別に指定したい場合は data-validon-on が優先になる。\n\t\tif(validon.eachfire) {\n\t\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tif(elems[i].getAttribute('data-validon-on')) continue\n\t\t\t\tif(elems[i].type==='radio' || elems[i].type==='checkbox' || elems[i].tagName==='SELECT') {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'change')\n\t\t\t\t} else {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'blur')\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 個別イベント登録\n\t\tvar elems = validon.form.querySelectorAll('[data-validon-on]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar elem = elems[i]\n\t\t\tvar eventName = elem.getAttribute('data-validon-on')\n\t\t\tif (elem.addEventListener) {\n\t\t\t\telem.addEventListener(eventName, function(e){ validon.send(this.name) }, false)\n\t\t\t} else if (elem.attachEvent) {\n\t\t\t\telem.attachEvent('on'+eventName, function(e){ validon.send(e.srcElement.name) })\n\t\t\t}\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(elems, callback){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elements = validon.form.querySelectorAll('[name]')\n\t\tfor(var i=0; i<elements.length; i++) {\n\t\t\tvar name = elements[i].getAttribute('name')\n\t\t\tif('undefined'!==typeof params[name]) continue\n\t\t\tif(elements[i].type==='radio') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name] = lump[i].value\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elements[i].type==='checkbox') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elements[i].tagName==='SELECT') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].selected) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams[name] = elements[i].value\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof elems ==='undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof elems ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(elems)\n\t\t} else if(elems instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tjson.targets.push(elems[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc) {\n\t\t\tif(false === validon.beforeFunc(json)) return false\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4 === this.readyState && 200 === this.status) {\n\t\t\t\tjson = this.response\n\t\t\t\tif('undefined' === typeof this.response) {\n\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t}\n\n\t\t\t\t// フック：afterFunc\n\t\t\t\tif(false === validon.afterFunc(json)) return false\n\n\t\t\t\t// ターゲットのみエラーを反映する\n\t\t\t\tif(json.targets.length) {\n\t\t\t\t\tfor(var i=0; i<json.targets.length; i++) {\n\t\t\t\t\t\tvar name = json.targets[i]\n\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\tvar errorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\tif(!errorholder.length) {\n\t\t\t\t\t\t\tvar parent = elem.parentNode\n\t\t\t\t\t\t\twhile (parent.tagName !== validon.errorgroup.toUpperCase()) {\n\t\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t\t\tif('undefined' === typeof parent.tagName) {\n\t\t\t\t\t\t\t\t\tparent = elem.parentNode\n\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\terrorholder = document.createElement('div')\n\t\t\t\t\t\t\terrorholder.setAttribute('data-validon-errorholder', name)\n\t\t\t\t\t\t\tif(validon.errorposition === 'append') {\n\t\t\t\t\t\t\t\tparent.appendChild(errorholder)\n\t\t\t\t\t\t\t} else if(validon.errorposition === 'prepend') {\n\t\t\t\t\t\t\t\tparent.insertBefore(errorholder, parent.childNodes[0]);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\terrorholder = new Array(errorholder)\n\t\t\t\t\t\t}\n\t\t\t\t\t\tvar message = ''\n\t\t\t\t\t\tif(json.errors && 'undefined' !== typeof json.errors[name]) {\n\t\t\t\t\t\t\tmessage = validon.errortag.replace(/\\$message/, json.errors[name])\n\t\t\t\t\t\t}\n\t\t\t\t\t\tfor(var j=0; j<errorholder.length; j++) {\n\t\t\t\t\t\t\terrorholder[j].innerHTML = message\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// 第二引数に関数が指定されていたらここで実行\n\t\t\t\tif(callback && typeof(callback)) {\n\t\t\t\t\tcallback(json)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n"]}