{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","replace","RegExp","location","origin","validon","form","opt","eachfire","beforeFunc","afterFunc","errortag","urlPath","console","window","onload","config","querySelector","warn","event","submitEvent","preventDefault","addEventListener","attachEvent","returnValue","elems","querySelectorAll","i","setAttribute","getAttribute","type","tagName","elem","eventName","send","name","srcElement","e","this","windowOnload","Validon","prototype","callback","json","params","lump","length","checked","value","selected","targets","isSubmit","Object","keys","push","Array","xhr","XMLHttpRequest","readyState","status","response","JSON","parse","responseText","_typeof","open","setRequestHeader","responseType","stringify","o","TypeError","k","p","hasOwnProperty"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form       = opt.form\n\tvalidon.config     = opt.config\n\tvalidon.eachfire   = opt.eachfire || false\n\tvalidon.errortag   = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.position   = opt.position || 'append'\n\tvalidon.beforeFunc = opt.beforeFunc\n\tvalidon.afterFunc  = opt.afterFunc\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火の標準設定（ラジオ、チェックボックス、プルダウンはonChange、それ以外はonBlurとす）\n\t\t// 個別に指定したい場合は data-validon-on が優先になる。\n\t\tif(validon.eachfire) {\n\t\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tif(elems[i].getAttribute('data-validon-on')) continue\n\t\t\t\tif(elems[i].type==='radio' || elems[i].type==='checkbox' || elems[i].tagName==='SELECT') {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'change')\n\t\t\t\t} else {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'blur')\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 個別イベント登録\n\t\tvar elems = validon.form.querySelectorAll('[data-validon-on]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar elem = elems[i]\n\t\t\tvar eventName = elem.getAttribute('data-validon-on')\n\t\t\tif (elem.addEventListener) {\n\t\t\t\telem.addEventListener(eventName, function(e){ validon.send(this.name) }, false)\n\t\t\t} else if (elem.attachEvent) {\n\t\t\t\telem.attachEvent('on'+eventName, function(e){ validon.send(e.srcElement.name) })\n\t\t\t}\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(elems, callback){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar name = elems[i].getAttribute('name')\n\t\t\tif('undefined'!==typeof params[name]) continue\n\t\t\tif(elems[i].type==='radio') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name] = lump[i].value\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].type==='checkbox') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].tagName==='SELECT') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].selected) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams[name] = elems[i].value\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof elems ==='undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof elems ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(elems)\n\t\t} else if(elems instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tjson.targets.push(elems[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc) {\n\t\t\tif(false===validon.beforeFunc(json)) return false\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4===this.readyState && 200===this.status) {\n\t\t\t\tjson = this.response\n\t\t\t\tif(typeof this.response ==='undefined') {\n\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t}\n\n\t\t\t\t// フック：afterFunc\n\t\t\t\tif(false===validon.afterFunc(json)) return false\n\n\t\t\t\t// ターゲットのみエラーを反映する\n\n\t\t\t\t// 第二引数に関数が指定されていたらここで実行\n\t\t\t\tif(callback && typeof(callback)) {\n\t\t\t\t\tcallback(json)\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n"]}