"use strict";var __validonUrlPath=(document.currentScript?document.currentScript.src:document.getElementsByTagName("script")[document.getElementsByTagName("script").length-1].src).replace(new RegExp("^"+location.origin),"").replace(/[^\/]+$/,"");function Validon(e){var a=this;a.form=e.form,a.config=e.config,a.eachfire=e.eachfire||!1,a.errorgroup=e.errorgroup||"section",a.errorposition=e.errorposition||"append",a.errortag=e.errortag||'<div class="error">$message</div>',a.startFunc=e.startFunc,a.beforeFunc=e.beforeFunc,a.afterFunc=e.afterFunc,a.finishFunc=e.finishFunc,a.urlPath=__validonUrlPath;var r=window.onload||function(){if(a.form=document.querySelector(a.form),!a.form)return console.warn("Validon can not set up. Please set exists form query."),!1;if(!a.config)return console.warn("Validon can not set up. Please set config."),!1;var e=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,a.send()};if(a.form.addEventListener?a.form.addEventListener("submit",e,!1):a.form.attachEvent&&a.form.attachEvent("onsubmit",e),a.eachfire)for(var r=a.form.querySelectorAll("[name]"),t=0;t<r.length;t++)r[t].getAttribute("data-validon-on")||("radio"===r[t].type||"checkbox"===r[t].type||"SELECT"===r[t].tagName?r[t].setAttribute("data-validon-on","change"):r[t].setAttribute("data-validon-on","blur"));for(r=a.form.querySelectorAll("[data-validon-on]"),t=0;t<r.length;t++){var n=r[t],o=n.getAttribute("data-validon-on");n.addEventListener?n.addEventListener(o,function(e){a.send(this.name)},!1):n.attachEvent&&n.attachEvent("on"+o,function(e){a.send(e.srcElement.name)})}};window.onload=function(){r()}}Validon.prototype={send:function(e,c){var l=this,u={config:this.config};if(l.startFunc&&"function"==typeof l.startFunc&&!1===l.startFunc(u))return!1;u.params=[];for(var r={},t=l.form.querySelectorAll("[name]"),n=0;n<t.length;n++){var o=t[n].getAttribute("name");if(void 0===r[o])if("radio"===t[n].type){var a=l.form.querySelectorAll('[name="'+o+'"]');for(n=0;n<a.length;n++)if(a[n].checked){r[o]=a[n].value;break}}else if("checkbox"===t[n].type){a=l.form.querySelectorAll('[name="'+o+'"]');for(r[o]=[],n=0;n<a.length;n++)a[n].checked&&r[o].push(a[n].value)}else if("SELECT"===t[n].tagName){a=l.form.querySelectorAll('[name="'+o+'"] option');for(r[o]=[],n=0;n<a.length;n++)a[n].selected&&r[o].push(a[n].value)}else r[o]=t[n].value}if(u.params=r,u.targets=[],u.isSubmit=!1,void 0===e)u.isSubmit=!0,u.targets=Object.keys(u.params);else if("string"==typeof e)u.targets.push(e);else if(e instanceof Array)for(n=0;n<e.length;n++)u.targets.push(e[n]);if(l.beforeFunc&&"function"==typeof l.beforeFunc&&!1===l.beforeFunc(u))return!1;var i=new XMLHttpRequest;return i.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(u=this.response,void 0===this.response&&(u=JSON.parse(this.responseText)),l.afterFunc&&"function"==typeof l.afterFunc&&!1===l.afterFunc(u))return!1;if(u.changes&&u.changes.length)for(var e=0;e<u.changes.length;e++){var r=u.changes[e];if("INPUT"!==(a=l.form.querySelector('[name="'+r+'"]')).tagName||"checkdradiobox"!==a.getAttribute("type")&&"checkbox"!==a.getAttribute("type"))if("SELECT"===a.tagName){var t=a.querySelectorAll("option");for(o=0;o<t.length;o++)t[o].selected=-1!==u.params[r].indexOf(t[o].value)}else a.value=u.params[r];else for(var n=l.form.querySelectorAll('[name="'+r+'"]'),o=0;o<n.length;o++)n[o].checked=-1!==u.params[r].indexOf(n[o].value)}if(u.targets&&u.targets.length)for(e=0;e<u.targets.length;e++){r=u.targets[e];var a=l.form.querySelector('[name="'+r+'"]'),i=l.form.querySelectorAll('[data-validon-errorholder="'+r+'"]');if(!i.length){for(var s=a.parentNode;s.tagName!==l.errorgroup.toUpperCase();)if(void 0===(s=s.parentNode).tagName){s=a.parentNode;break}(i=document.createElement("div")).setAttribute("data-validon-errorholder",r),"append"===l.errorposition?s.appendChild(i):"prepend"===l.errorposition&&s.insertBefore(i,s.childNodes[0]),i=new Array(i)}var f="";u.errors&&void 0!==u.errors[r]&&(f=l.errortag.replace(/\$message/,u.errors[r]));for(o=0;o<i.length;o++)i[o].innerHTML=f}if(c&&"function"==typeof c&&c(u),l.finishFunc&&"function"==typeof l.finishFunc&&!1===l.finishFunc(u))return!1;!u.errors&&u.isSubmit&&l.form.submit()}},i.open("POST",l.urlPath+"validon.php"),i.setRequestHeader("Content-Type","application/json"),i.responseType="json",i.send(JSON.stringify(u)),this}},Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var r,t=[];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,i,s){return function(e,r){if(null==this)throw TypeError("Array.prototype.indexOf called on null or undefined");var t=a(this),n=t.length>>>0,o=s(0|r,n);if(o<0)o=i(0,n+o);else if(n<=o)return-1;if(void 0===e){for(;o!==n;++o)if(void 0===t[o]&&o in t)return o}else if(e!=e){for(;o!==n;++o)if(t[o]!=t[o])return o}else for(;o!==n;++o)if(t[o]===e)return o;return-1}}(Object,Math.max,Math.min));
//# sourceMappingURL=validon.js.map
