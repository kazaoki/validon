{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","replace","RegExp","location","origin","validon","form","opt","eachfire","errortag","loadedFunc","startFunc","beforeFunc","afterFunc","finishFunc","urlPath","console","window","onload","config","querySelector","warn","style","pointerEvents","addEventListener","event","preventDefault","attachEvent","returnValue","submitEvent","querySelectorAll","elems","i","eventName","length","getAttribute","eventNames","name","send","split","j","e","this","srcElement","windowOnload","onerror","msg","url","line","col","error","objectMerge","a","b","key","hasOwnProperty","Object","prototype","toString","call","concat","Validon","callback","json","hasFileApi","elements","params","File","matches","match","_typeof","Array","value","lump","checked","paramSet","files","tagName","push","type","size","targets","isSubmit","keys","XMLHttpRequest","onreadystatechange","status","xhr","readyState","response","JSON","parse","responseText","changes","options","elem","selected","indexOf","list","errors","errorholder","raw_name","parent","parentNode","insertBefore","errorgroup","toUpperCase","message","errorposition","appendChild","childNodes","innerHTML","responseType","setRequestHeader","submit","open","$f","stringify","setkey","merged","data","retvar","o","k","Len","that","TypeError","p","max","min","member","fromIndex","Math"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form          = opt.form\n\tvalidon.config        = opt.config\n\tvalidon.eachfire      = opt.eachfire || false\n\tvalidon.errorgroup    = opt.errorgroup || 'section'\n\tvalidon.errorposition = opt.errorposition || 'append'\n\tvalidon.errortag      = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.loadedFunc    = opt.loadedFunc  // コンストラクタ生成後に実行する関数\n\tvalidon.startFunc     = opt.startFunc   // 開始してすぐ実行する関数\n\tvalidon.beforeFunc    = opt.beforeFunc  // json送信直前に実行する関数\n\tvalidon.afterFunc     = opt.afterFunc   // json受信直後に実行する関数\n\tvalidon.finishFunc    = opt.finishFunc  // 処理完了後に実行する関数\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// 対象フォームがクリック不可になっていたら困るので戻し\n\t\tvalidon.form.style.pointerEvents = ''\n\n\t\t// submitイベント登録\n\t\tvar submitEvent = function(event){\n\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false\n\t\t\tvalidon.send()\n\t\t}\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', submitEvent, false)\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', submitEvent)\n\t\t}\n\n\t\t// 要素ごとのイベント発火が有効の場合、各要素に `onChange` が登録され都度バリデートされるようになる。\n\t\t// ※要素ごとに設定も可能（例： data-validon-on='change,keydown' ← カンマで複数指定可\n\t\tif(validon.eachfire || validon.form.querySelectorAll('[data-validon-on]').length) {\n\t\t\tvar elems = validon.eachfire\n\t\t\t\t? validon.form.querySelectorAll('[name]')\n\t\t\t\t: validon.form.querySelectorAll('[data-validon-on]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tvar eventName = elems[i].getAttribute('data-validon-on')\n\t\t\t\tif(!eventName) {\n\t\t\t\t\tif(\n\t\t\t\t\t\telems[i].type==='radio' ||\n\t\t\t\t\t\telems[i].type==='checkbox' ||\n\t\t\t\t\t\telems[i].type==='file' ||\n\t\t\t\t\t\telems[i].tagName==='SELECT'\n\t\t\t\t\t) {\n\t\t\t\t\t\teventName = 'change'\n\t\t\t\t\t} else {\n\t\t\t\t\t\teventName = 'blur'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tvar eventNames = eventName.split(/\\s*\\,\\s*/)\n\t\t\t\tfor(var j=0; j<eventNames.length; j++) {\n\t\t\t\t\tvar event = eventNames[j];\n\t\t\t\t\tif (elems[i].addEventListener) {\n\t\t\t\t\t\telems[i].addEventListener(event, function(e){ validon.send(this.name) }, false)\n\t\t\t\t\t} else if (elems[i].attachEvent) {\n\t\t\t\t\t\telems[i].attachEvent('on'+event, function(e){ validon.send(e.srcElement.name) })\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// フック：loadedFunc\n\t\tif(validon.loadedFunc && 'function' === typeof validon.loadedFunc) {\n\t\t\tif(false === validon.loadedFunc()) return false\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n\n\t// エラーが起きたら対象フォームのクリック解除\n\twindow.onerror = function(msg, url, line, col, error) {\n\t\tvalidon.form.style.pointerEvents = ''\n\t}\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * PHPにデータを送信してバリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tsend: function(elems, callback){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// フック：startFunc\n\t\tif(validon.startFunc && 'function' === typeof validon.startFunc) {\n\t\t\tif(false === validon.startFunc(json)) return false\n\t\t}\n\n\t\t// submit中は要素を全てクリックできないように\n\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = 'none'\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elements = validon.form.querySelectorAll('[name]')\n\t\tvar hasFileApi = !!window.File;\n\t\tfor(var i=0; i<elements.length; i++) {\n\n\t\t\tvar name = elements[i].getAttribute('name')\n\n\t\t\t// 各要素にとりあえず空をセットする（未選択要素でもajaxで飛ばしたいので）\n\t\t\tvar matches;\n\t\t\tif(matches = name.match(/^(.+?)\\[(.*)\\]$/)) {\n\t\t\t\tif(matches[2].length){\n\t\t\t\t\t// name=\"color[abc]\"\n\t\t\t\t\tif('object'!==typeof params[matches[1]]) params[matches[1]] = new Object()\n\t\t\t\t} else {\n\t\t\t\t\t// name=\"color[]\"\n\t\t\t\t\tif('object'!==typeof params[matches[1]]) params[matches[1]] = new Array()\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// name=\"color\"\n\t\t\t\tif('undefined'===typeof params[name]) params[name] = ''\n\t\t\t}\n\n\t\t\t// ラジオボタン or チェックボックス\n\t\t\tif(\n\t\t\t\t'radio'   ===elements[i].type ||\n\t\t\t\t'checkbox'===elements[i].type\n\t\t\t) {\n\t\t\t\tif(elements[i].checked) {\n\t\t\t\t\tthis.paramSet(params, name, elements[i].value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// セレクトプルダウン\n\t\t\telse if('SELECT'===elements[i].tagName) {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tfor(var j=0; j<lump.length; j++) {\n\t\t\t\t\tif(lump[j].selected) this.paramSet(params, name, lump[j].value)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// ファイル選択（FileAPIが使用できる場合は name,type,size をセットする）\n\t\t\telse if(elements[i].type==='file' && hasFileApi) {\n\t\t\t\tif(elements[i].files.length) {\n\t\t\t\t\tvar files = new Array();\n\t\t\t\t\tfor(var j=0; j<elements[i].files.length; j++){\n\t\t\t\t\t\tfiles.push({\n\t\t\t\t\t\t\tname: elements[i].files[j]['name'],\n\t\t\t\t\t\t\ttype: elements[i].files[j]['type'],\n\t\t\t\t\t\t\tsize: elements[i].files[j]['size'],\n\t\t\t\t\t\t})\n\t\t\t\t\t}\n\t\t\t\t\tif(1===files.length) files=files[0] // 1つなら上へ上げる\n\t\t\t\t\tthis.paramSet(params, name, files)\n\t\t\t\t}\n\t\t\t}\n\t\t\t// その他の要素\n\t\t\telse {\n\t\t\t\tthis.paramSet(params, name, elements[i].value)\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tjson.isSubmit = false\n\t\tif(typeof elems === 'undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.isSubmit = true\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof elems ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(elems)\n\t\t} else if(elems instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tjson.targets.push(elems[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc && 'function' === typeof validon.beforeFunc) {\n\t\t\tif(false === validon.beforeFunc(json)) {\n\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\treturn false\n\t\t\t}\n\t\t}\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4 === this.readyState) {\n\t\t\t\tif(200 === this.status) {\n\t\t\t\t\tjson = this.response\n\t\t\t\t\tif('undefined' === typeof json || 'string' === typeof json) {\n\t\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：afterFunc\n\t\t\t\t\tif(validon.afterFunc && 'function' === typeof validon.afterFunc) {\n\t\t\t\t\t\tif(false === validon.afterFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみ値の変更があれば反映する\n\t\t\t\t\tif(json.changes && json.changes.length) {\n\t\t\t\t\t\tfor(var i=0; i<json.changes.length; i++) {\n\t\t\t\t\t\t\tvar name = json.changes[i]\n\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(!elem) continue\n\t\t\t\t\t\t\tif(\n\t\t\t\t\t\t\t\t'INPUT' === elem.tagName &&\n\t\t\t\t\t\t\t\t('radio' === elem.getAttribute('type') || 'checkbox' === elem.getAttribute('type'))\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tvar elems = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\t\tfor(var j=0; j<elems.length; j++) {\n\t\t\t\t\t\t\t\t\telems[j].checked = -1 !== json.params[name].indexOf(elems[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else if('SELECT' === elem.tagName) {\n\t\t\t\t\t\t\t\tvar options = elem.querySelectorAll('option')\n\t\t\t\t\t\t\t\tfor(var j=0; j<options.length; j++) {\n\t\t\t\t\t\t\t\t\toptions[j].selected = -1 !== json.params[name].indexOf(options[j].value)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\telem.value = json.params[name]\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// ターゲットのみエラーがあれば反映する\n\t\t\t\t\tif(json.targets && json.targets.length) {\n\t\t\t\t\t\t// エラーにxxx[]が入ってくるようであれば、キーがxxxだけでも表示対象にするように。\n\t\t\t\t\t\tvar list = json.targets;\n\t\t\t\t\t\tfor(var i in list) {\n\t\t\t\t\t\t\tfor(var key in json.errors) {\n\t\t\t\t\t\t\t\tif(key.match(new RegExp('^'+list[i]+'\\\\\\['))) list.push(key)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// 開始\n\t\t\t\t\t\tfor(var i=0; i<list.length; i++) {\n\t\t\t\t\t\t\tvar name = list[i]\n\t\t\t\t\t\t\tvar raw_name = name.replace(/\\[.*?\\]/, '')\n\t\t\t\t\t\t\tvar errorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\t\tif(!errorholder.length){\n\t\t\t\t\t\t\t\t// [] はずしたもので探す\n\t\t\t\t\t\t\t\tname = raw_name\n\t\t\t\t\t\t\t\terrorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\n\t\t\t\t\t\t\t\t// 無ければ [] つけたもので探す\n\t\t\t\t\t\t\t\tif(!errorholder.length){\n\t\t\t\t\t\t\t\t\tname = raw_name+'[]'\n\t\t\t\t\t\t\t\t\terrorholder = validon.form.querySelectorAll('[data-validon-errorholder=\"'+name+'\"]')\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t// エラーホルダーが指定されてなければ自動で用意\n\t\t\t\t\t\t\tif(!errorholder.length) {\n\n\t\t\t\t\t\t\t\t// 対象要素探す\n\t\t\t\t\t\t\t\tvar elem = validon.form.querySelector('[name=\"'+name+'\"]')\n\t\t\t\t\t\t\t\tif(!elem) {\n\t\t\t\t\t\t\t\t\t// なければ[]付きのを要素を探す\n\t\t\t\t\t\t\t\t\telem = validon.form.querySelector('[name^=\"'+name+'[\"]')\n\t\t\t\t\t\t\t\t\tif(!elem) {\n\t\t\t\t\t\t\t\t\t\tconsole.warn('Missing element: \"'+name+'\"');\n\t\t\t\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t// 対象要素の位置からエラーホルダーを生成する\n\t\t\t\t\t\t\t\tvar parent = elem.parentNode\n\t\t\t\t\t\t\t\twhile (parent.tagName !== validon.errorgroup.toUpperCase()) {\n\t\t\t\t\t\t\t\t\tparent = parent.parentNode;\n\t\t\t\t\t\t\t\t\tif('undefined' === typeof parent.tagName) {\n\t\t\t\t\t\t\t\t\t\tparent = elem.parentNode\n\t\t\t\t\t\t\t\t\t\tbreak\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = document.createElement('div')\n\t\t\t\t\t\t\t\terrorholder.setAttribute('data-validon-errorholder', name)\n\t\t\t\t\t\t\t\tif(validon.errorposition === 'append') {\n\t\t\t\t\t\t\t\t\tparent.appendChild(errorholder)\n\t\t\t\t\t\t\t\t} else if(validon.errorposition === 'prepend') {\n\t\t\t\t\t\t\t\t\tparent.insertBefore(errorholder, parent.childNodes[0]);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\terrorholder = new Array(errorholder)\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tvar message = ''\n\t\t\t\t\t\t\tif(json.errors && 'undefined' !== typeof json.errors[raw_name]) {\n\t\t\t\t\t\t\t\tmessage = validon.errortag.replace(/\\$message/, json.errors[raw_name])\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tfor(var j=0; j<errorholder.length; j++) {\n\t\t\t\t\t\t\t\terrorholder[j].innerHTML = message\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// 第二引数に関数が指定されていたらここで実行\n\t\t\t\t\tif(callback && 'function' === typeof callback) {\n\t\t\t\t\t\tcallback(json)\n\t\t\t\t\t}\n\n\t\t\t\t\t// フック：finsihFunc\n\t\t\t\t\tif(validon.finishFunc && 'function' === typeof validon.finishFunc) {\n\t\t\t\t\t\tif(false === validon.finishFunc(json)) {\n\t\t\t\t\t\t\t// クリック不可を戻してイベントキャンセル\n\t\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t\t\treturn false\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// エラーが一つも無ければsubmitする（isSubmit時のみ）\n\t\t\t\t\tif(!Object.keys(json.errors).length && json.isSubmit) validon.form.submit()\n\t\t\t\t\telse {\n\t\t\t\t\t\t// エラーがある場合はsubmit中のクリック不可を戻す\n\t\t\t\t\t\tif(typeof elems === 'undefined') validon.form.style.pointerEvents = ''\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t},\n\n\t/**\n\t * params変数をセットするメソッド。キー名に[.*]がある場合は1次元まで配列にする。\n\t *\n\t * ex. color=red           -> params['color']   = 'red'\n\t * ex. color[]=red         -> params['color[]'] = ['red']\n\t * ex. color[123]=red      -> params['color[]'] = [{'123': 'red'}]\n\t * ex. color[123][456]=red -> params['color[]'] = [{'123[456]': 'red'}]\n\t */\n\tparamSet: function(params, name, value)\n\t{\n\t\t// 配列・オブジェクトに展開する再帰関数\n\t\tvar $f = function(key, value)\n\t\t{\n\t\t\tvar matches;\n\t\t\tif(matches = key.match(/^.*?\\[(.*?)\\](.*)$/)) {\n\t\t\t\tif(matches[1].length) {\n\t\t\t\t\tvar retvar = new Object()\n\t\t\t\t\tretvar[matches[1]] = matches[2]\n\t\t\t\t\t\t? $f(matches[2], value)\n\t\t\t\t\t\t: value\n\t\t\t\t\t;\n\t\t\t\t\treturn retvar\n\t\t\t\t} else {\n\t\t\t\t\tvar retvar = new Array()\n\t\t\t\t\tretvar.push(matches[2]\n\t\t\t\t\t\t? $f(matches[2], value)\n\t\t\t\t\t\t: value\n\t\t\t\t\t)\n\t\t\t\t\treturn retvar\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn value\n\t\t\t}\n\t\t}\n\n\t\t// セットするキー名生成\n\t\tvar setkey = name.replace(/\\[.*$/, '')\n\n\t\t// 既存のオブジェクトとマージ\n\t\tvar merged = objectMerge(\n\t\t\t{data: $f(name, value)},\n\t\t\t{data: params[setkey]}\n\t\t)\n\t\tparams[setkey] = merged['data']\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n\n/**\n * Array.indexOf Polyfill\n * https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Global_Objects/Array/indexOf#Polyfill\n */\nif (!Array.prototype.indexOf) Array.prototype.indexOf = (function (Object, max, min) {\n\t\"use strict\";\n\treturn function indexOf(member, fromIndex) {\n\t\tif (this === null || this === undefined) throw TypeError(\"Array.prototype.indexOf called on null or undefined\");\n\t\tvar that = Object(this), Len = that.length >>> 0, i = min(fromIndex | 0, Len);\n\t\tif (i < 0) i = max(0, Len + i); else if (i >= Len) return -1;\n\t\tif (member === void 0) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] === void 0 && i in that) return i; // undefined\n\t\t} else if (member !== member) {\n\t\t\tfor (; i !== Len; ++i) if (that[i] !== that[i]) return i; // NaN\n\t\t} else for (; i !== Len; ++i) if (that[i] === member) return i; // all else\n\t\treturn -1; // if the value was not found, then return -1\n\t};\n})(Object, Math.max, Math.min);\n\n/**\n * オブジェクトマージ関数\n * ※配列はconcat()される\n */\nfunction objectMerge(a, b) {\n\tfor (var key in b) {\n\t\tif (b.hasOwnProperty(key)) {\n\t\t\ta[key] = (key in a)\n\t\t\t\t? (\n\t\t\t\t\t(\n\t\t\t\t\t\tObject.prototype.toString.call(a[key]) === '[object Object]' &&\n\t\t\t\t\t\tObject.prototype.toString.call(b[key]) === '[object Object]'\n\t\t\t\t\t)\n\t\t\t\t\t\t? objectMerge(a[key], b[key])\n\t\t\t\t\t\t: (\n\t\t\t\t\t\t\t(\n\t\t\t\t\t\t\t\tObject.prototype.toString.call(a[key]) === '[object Array]' &&\n\t\t\t\t\t\t\t\tObject.prototype.toString.call(b[key]) === '[object Array]'\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t? b[key].concat(a[key])\n\t\t\t\t\t\t\t\t: a[key]\n\t\t\t\t\t\t)\n\t\t\t\t\t)\n\t\t\t\t: b[key];\n\t\t}\n\t}\n\treturn a;\n};\n"]}