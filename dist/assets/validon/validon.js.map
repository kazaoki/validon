{"version":3,"sources":["validon.js"],"names":["__validonUrlPath","document","currentScript","src","getElementsByTagName","length","replace","RegExp","location","origin","Validon","validon","eachfire","opt","position","form","config","urlPath","errortag","windowOnload","window","afterFunc","onload","querySelector","console","warn","event","preventDefault","elems","e","returnValue","attachEvent","querySelectorAll","i","getAttribute","type","tagName","setAttribute","elem","srcElement","name","addEventListener","eventName","this","prototype","args","json","params","lump","checked","value","push","selected","targets","Object","keys","Array","beforeFunc","xhr","onreadystatechange","readyState","status","JSON","response","parse","responseText","responseType","send","stringify","p","o","k","hasOwnProperty","call"],"mappings":"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","file":"validon.js","sourcesContent":["\n/**\n * set url path\n */\nvar __validonUrlPath = (\n\tdocument.currentScript\n\t\t? document.currentScript.src\n\t\t: document.getElementsByTagName('script')[document.getElementsByTagName('script').length-1].src\n\t)\n\t.replace(new RegExp('^'+location.origin), '')\n\t.replace(/[^\\/]+$/, '')\n;\n\n/**\n * コンストラクタ\n */\nfunction Validon(opt)\n{\n\tvar validon = this;\n\n\t// オプションセット\n\tvalidon.form       = opt.form\n\tvalidon.config     = opt.config\n\tvalidon.eachfire   = opt.eachfire || false\n\tvalidon.errortag   = opt.errortag || '<div class=\"error\">$message</div>'\n\tvalidon.position   = opt.position || 'append'\n\tvalidon.beforeFunc = opt.beforeFunc\n\tvalidon.afterFunc  = opt.afterFunc\n\n\t// URLパス設定\n\tvalidon.urlPath = __validonUrlPath\n\n\t// オンロードセット\n\tvar windowOnload = window.onload || function () {\n\n\t\t// 設定チェック\n\t\tvalidon.form = document.querySelector(validon.form)\n\t\tif(!validon.form){\n\t\t\tconsole.warn('Validon can not set up. Please set exists form query.')\n\t\t\treturn false\n\t\t}\n\t\tif(!validon.config){\n\t\t\tconsole.warn('Validon can not set up. Please set config.')\n\t\t\treturn false\n\t\t}\n\n\t\t// submitイベント登録\n\t\tif (validon.form.addEventListener) {\n\t\t\tvalidon.form.addEventListener('submit', function(e){\n\t\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false;\n\t\t\t\tvalidon.validon()\n\t\t\t}, false);\n\t\t} else if (validon.form.attachEvent) {\n\t\t\tvalidon.form.attachEvent('onsubmit', function(e){\n\t\t\t\t(event.preventDefault) ? event.preventDefault() : event.returnValue = false;\n\t\t\t\tvalidon.validon()\n\t\t\t})\n\t\t}\n\n\t\t// 要素ごとのイベント発火の標準設定（ラジオ、チェックボックス、プルダウンはonChange、それ以外はonBlurとす）\n\t\t// 個別に指定したい場合は data-validon-on が優先になる。\n\t\tif(validon.eachfire) {\n\t\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\t\tif(elems[i].getAttribute('data-validon-on')) continue\n\t\t\t\tif(elems[i].type==='radio' || elems[i].type==='checkbox' || elems[i].tagName==='SELECT') {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'change')\n\t\t\t\t} else {\n\t\t\t\t\telems[i].setAttribute('data-validon-on', 'blur')\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// 個別イベント登録\n\t\tvar elems = validon.form.querySelectorAll('[data-validon-on]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar elem = elems[i]\n\t\t\tvar eventName = elem.getAttribute('data-validon-on')\n\t\t\tif (elem.addEventListener) {\n\t\t\t\telem.addEventListener(eventName, function(e){ validon.validon(this.name) }, false)\n\t\t\t} else if (elem.attachEvent) {\n\t\t\t\telem.attachEvent('on'+eventName, function(e){ validon.validon(e.srcElement.name) })\n\t\t\t}\n\t\t}\n\t};\n\twindow.onload = function () { windowOnload(); };\n}\n\n/**\n * メソッド\n */\nValidon.prototype = {\n\n\t/**\n\t * バリデート実行\n\t *\n\t * - 引数空ならsubmit実行（全要素をバリデート対象にする\n\t * - 引数に文字列が入っている場合はnameとしてバリデート対象にする\n\t * - 引数に複数の文字列が配列で入っている場合は複数のnameとしてバリデート対象にする\n\t */\n\tvalidon: function(args){\n\t\tvar validon = this\n\t\tvar json = {\n\t\t\tconfig: this.config\n\t\t};\n\n\t\t// 値まとめ\n\t\tjson.params = []\n\t\tvar params = {}\n\t\tvar elems = validon.form.querySelectorAll('[name]')\n\t\tfor(var i=0; i<elems.length; i++) {\n\t\t\tvar name = elems[i].getAttribute('name')\n\t\t\tif('undefined'!==typeof params[name]) continue\n\t\t\tif(elems[i].type==='radio') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name] = lump[i].value\n\t\t\t\t\t\tbreak\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].type==='checkbox') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"]')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].checked) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if(elems[i].tagName==='SELECT') {\n\t\t\t\tvar lump = validon.form.querySelectorAll('[name=\"'+name+'\"] option')\n\t\t\t\tparams[name] = []\n\t\t\t\tfor(i=0; i<lump.length; i++) {\n\t\t\t\t\tif(lump[i].selected) {\n\t\t\t\t\t\tparams[name].push(lump[i].value)\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tparams[name] = elems[i].value\n\t\t\t}\n\t\t}\n\t\tjson.params = params\n\n\t\t// 対象要素まとめ\n\t\tjson.targets = []\n\t\tif(typeof args ==='undefined') {\n\t\t\t// submitバリデートの場合全ての値\n\t\t\tjson.targets = Object.keys(json.params)\n\t\t} else if(typeof args ==='string') {\n\t\t\t// 個別バリデート：単体の場合（要素ごとのバリデート発火など）\n\t\t\tjson.targets.push(args)\n\t\t} else if(args instanceof Array) {\n\t\t\t// 個別バリデート：複数の場合（直接jsからvalidate()実行など）\n\t\t\tfor(var i=0; i<args.length; i++) {\n\t\t\t\tjson.targets.push(args[i])\n\t\t\t}\n\t\t}\n\n\t\t// フック：beforeFunc\n\t\tif(validon.beforeFunc) validon.beforeFunc(json)\n\n\t\t// Ajax\n\t\tvar xhr = new XMLHttpRequest();\n\t\txhr.onreadystatechange = function()\n\t\t{\n\t\t\tif(4===this.readyState && 200===this.status) {\n\t\t\t\tjson = this.response\n\t\t\t\tif(typeof this.response ==='undefined') {\n\t\t\t\t\tjson = JSON.parse(this.responseText)\n\t\t\t\t}\n\n\t\t\t\t// フック：afterFunc\n\t\t\t\tif(validon.beforeFunc) validon.afterFunc(json)\n\t\t\t}\n\t\t}\n\t\txhr.open('POST', validon.urlPath+'validon.php')\n\t\txhr.setRequestHeader('Content-Type', 'application/json')\n\t\txhr.responseType = 'json'\n\t\txhr.send(JSON.stringify(json))\n\n\t\treturn this\n\t}\n}\n\n/**\n * Object.keys Polyfill\n * http://tokenposts.blogspot.com/2012/04/javascript-objectkeys-browser.html\n */\nif (!Object.keys) Object.keys = function(o) {\n\tif (o !== Object(o))\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\tvar k=[],p;\n\tfor (p in o) if (Object.prototype.hasOwnProperty.call(o,p)) k.push(p);\n\treturn k;\n}\n"]}