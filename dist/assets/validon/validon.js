"use strict";var __validonUrlPath=(document.currentScript?document.currentScript.src:document.getElementsByTagName("script")[document.getElementsByTagName("script").length-1].src).replace(new RegExp("^"+location.origin),"").replace(/[^\/]+$/,"");function Validon(e){var s=this;s.form=e.form,s.config=e.config,s.eachfire=e.eachfire||!1,s.errorgroup=e.errorgroup||"section",s.errorposition=e.errorposition||"append",s.errortag=e.errortag||'<div class="error">$message</div>',s.startFunc=e.startFunc,s.beforeFunc=e.beforeFunc,s.afterFunc=e.afterFunc,s.finishFunc=e.finishFunc,s.urlPath=__validonUrlPath;var r=window.onload||function(){if(s.form=document.querySelector(s.form),!s.form)return console.warn("Validon can not set up. Please set exists form query."),!1;if(!s.config)return console.warn("Validon can not set up. Please set config."),!1;var e=function(e){e.preventDefault?e.preventDefault():e.returnValue=!1,s.send()};if(s.form.addEventListener?s.form.addEventListener("submit",e,!1):s.form.attachEvent&&s.form.attachEvent("onsubmit",e),s.eachfire)for(var r=s.form.querySelectorAll("[name]"),t=0;t<r.length;t++){var n=r[t].getAttribute("data-validon-on");n||(n="radio"===r[t].type||"checkbox"===r[t].type||"file"===r[t].type||"SELECT"===r[t].tagName?"change":"blur");for(var o=n.split(/\s*\,\s*/),a=0;a<o.length;a++){var i=o[a];r[t].addEventListener?r[t].addEventListener(i,function(e){s.send(this.name)},!1):r[t].attachEvent&&r[t].attachEvent("on"+i,function(e){s.send(e.srcElement.name)})}}};window.onload=function(){r()}}Validon.prototype={send:function(e,c){var l=this,u={config:this.config};if(l.startFunc&&"function"==typeof l.startFunc&&!1===l.startFunc(u))return!1;u.params=[];for(var r={},t=l.form.querySelectorAll("[name]"),n=!!window.File,o=0;o<t.length;o++){var a=t[o].getAttribute("name");if(void 0===r[a])if("radio"===t[o].type){for(var i=l.form.querySelectorAll('[name="'+a+'"]'),s=0;s<i.length;s++)if(i[s].checked){r[a]=i[s].value;break}}else if("checkbox"===t[o].type){i=l.form.querySelectorAll('[name="'+a+'"]');r[a]=[];for(s=0;s<i.length;s++)i[s].checked&&r[a].push(i[s].value)}else if("SELECT"===t[o].tagName){i=l.form.querySelectorAll('[name="'+a+'"] option');r[a]=[];for(s=0;s<i.length;s++)i[s].selected&&r[a].push(i[s].value)}else if("file"===t[o].type&&n){var f=l.form.querySelector('[name="'+a+'"]'),p=new Array;for(s=0;s<f.files.length;s++)p.push({name:f.files[s].name,type:f.files[s].type,size:f.files[s].size});a.match(/\]$/)?r[a]=p:r[a]=p[0]}else r[a]=t[o].value}if(u.params=r,u.targets=[],u.isSubmit=!1,void 0===e)u.isSubmit=!0,u.targets=Object.keys(u.params);else if("string"==typeof e)u.targets.push(e);else if(e instanceof Array)for(o=0;o<e.length;o++)u.targets.push(e[o]);if(l.beforeFunc&&"function"==typeof l.beforeFunc&&!1===l.beforeFunc(u))return!1;var d=new XMLHttpRequest;return d.onreadystatechange=function(){if(4===this.readyState&&200===this.status){if(u=this.response,void 0===this.response&&(u=JSON.parse(this.responseText)),l.afterFunc&&"function"==typeof l.afterFunc&&!1===l.afterFunc(u))return!1;if(u.changes&&u.changes.length)for(var e=0;e<u.changes.length;e++){var r=u.changes[e];if("INPUT"!==(a=l.form.querySelector('[name="'+r+'"]')).tagName||"checkdradiobox"!==a.getAttribute("type")&&"checkbox"!==a.getAttribute("type"))if("SELECT"===a.tagName){var t=a.querySelectorAll("option");for(o=0;o<t.length;o++)t[o].selected=-1!==u.params[r].indexOf(t[o].value)}else a.value=u.params[r];else for(var n=l.form.querySelectorAll('[name="'+r+'"]'),o=0;o<n.length;o++)n[o].checked=-1!==u.params[r].indexOf(n[o].value)}if(u.targets&&u.targets.length)for(e=0;e<u.targets.length;e++){r=u.targets[e];var a=l.form.querySelector('[name="'+r+'"]'),i=l.form.querySelectorAll('[data-validon-errorholder="'+r+'"]');if(!i.length){for(var s=a.parentNode;s.tagName!==l.errorgroup.toUpperCase();)if(void 0===(s=s.parentNode).tagName){s=a.parentNode;break}(i=document.createElement("div")).setAttribute("data-validon-errorholder",r),"append"===l.errorposition?s.appendChild(i):"prepend"===l.errorposition&&s.insertBefore(i,s.childNodes[0]),i=new Array(i)}var f="";u.errors&&void 0!==u.errors[r]&&(f=l.errortag.replace(/\$message/,u.errors[r]));for(o=0;o<i.length;o++)i[o].innerHTML=f}if(c&&"function"==typeof c&&c(u),l.finishFunc&&"function"==typeof l.finishFunc&&!1===l.finishFunc(u))return!1;!u.errors&&u.isSubmit&&l.form.submit()}},d.open("POST",l.urlPath+"validon.php"),d.setRequestHeader("Content-Type","application/json"),d.responseType="json",d.send(JSON.stringify(u)),this}},Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var r,t=[];for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t}),Array.prototype.indexOf||(Array.prototype.indexOf=function(a,i,s){return function(e,r){if(null==this)throw TypeError("Array.prototype.indexOf called on null or undefined");var t=a(this),n=t.length>>>0,o=s(0|r,n);if(o<0)o=i(0,n+o);else if(n<=o)return-1;if(void 0===e){for(;o!==n;++o)if(void 0===t[o]&&o in t)return o}else if(e!=e){for(;o!==n;++o)if(t[o]!=t[o])return o}else for(;o!==n;++o)if(t[o]===e)return o;return-1}}(Object,Math.max,Math.min));
//# sourceMappingURL=validon.js.map
